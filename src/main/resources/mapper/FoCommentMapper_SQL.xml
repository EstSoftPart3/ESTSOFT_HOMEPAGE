<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.eep.mapper.FoCommentMapper">
	
	<!--댓글 리스트 조회 -->
	<select id="commentListData" resultType="hashMap" parameterType="hashMap">
		SELECT 
			A.CMMNT_SQ 									AS cmmntSq
			,A.BRD_SQ 									AS brdSq
			,A.EMPLY_SQ 								AS emplySq
			,A.CMMNT_CNTNT 								AS cmmntCntnt
			,DATE_FORMAT(A.CMMNT_REG_DT, '%Y-%m-%d') 	AS cmmntRegDt
			,DATE_FORMAT(A.CMMNT_UPDT_DT, '%Y-%m-%d') 	AS cmmntUpdtDt
			,B.EMPLY_NM 								AS emplyNm
		FROM
			TB_EEP_BRD_CMMNT_M A
			INNER JOIN
				tb_eep_emply_m B 
			ON
				 A.EMPLY_SQ = B.EMPLY_SQ 
		WHERE
			A.BRD_SQ = #{brdSq}
			AND A.UES_YN = 'Y'
			AND A.DEL_YN = 'n'
			
	</select>
	
	<!-- 댓글 등록, 수정 -->
	<!-- 댓글 SEQ에 따라서 유동적으로 등록, 수정 처리 / 이미 존재하는 SEQ를 넣을 시 수정 -->
	<insert id="commentWorkData" parameterType="hashMap">
		INSERT INTO TB_EEP_BRD_CMMNT_M
		(
			CMMNT_SQ
			,BRD_SQ
			,EMPLY_SQ
			,CMMNT_CNTNT
			,CMMNT_REG_DT
			,UES_YN
			,DEL_YN
		)
		VALUES
		(
		<if test='cmmntSq == null'>
			NULL
		</if>
		<if test='cmmntSq != null'>
			#{cmmntSq}
		</if>
			,#{brdSq}
			,#{emplySq}
			,#{cmmntCntnt}
			,now()
			,'Y'
			,'N'
		)
		<!-- 등록하다 같은 키가 중복될 시 업데이트 -->
		ON DUPLICATE KEY UPDATE
			CMMNT_UPDT_DT = now()
		<if test='uesYn == null'>
			,CMMNT_CNTNT = #{cmmntCntnt}
		</if>
		<!-- 삭제 요청 처리 들어오면 비활성화 -->
		<if test='uesYn != null'>
			,UES_YN = #{uesYn}
			,DEL_YN = #{delYn}
		</if>
			
	</insert>
	
</mapper>