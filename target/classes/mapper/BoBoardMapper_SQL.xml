<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.eep.mapper.BoBoardMapper">
	
	<!-- 원본, 답글 전체 리스트 데이터 조회 -->
	<select id="boardListData" resultType="hashMap">
    
        SELECT 	BOARD_SEQ AS boardSeq
              , BOARD_RE_REF AS boardReRef
              , BOARD_RE_LEV AS boardReLev
              , BOARD_RE_SEQ AS boardReSeq
              , BOARD_WRITER AS boardWriter
              , BOARD_SUBJECT AS boardSubject
              , BOARD_CONTENT AS boardContent
              , BOARD_HITS AS boardHits
              , DEL_YN AS delYn
              , INS_USER_ID AS insUserId
              , CAST( DATE_FORMAT( INS_DATE, '%Y-%m-%d %H:%i:%s' ) AS CHAR(19) ) AS insDate
        FROM 
        		TB_BOARD ORDER BY BOARD_RE_REF DESC, BOARD_RE_SEQ ASC

    </select>
    
    <!-- //////////////// -->
	<!-- 공지시항 게시판 Mapper -->
	<!-- ////////////////-->
    
    <!-- 공지사항 목록 및 조회 -->
	<select id="noticeBoardListData" resultType="hashMap" parameterType="hashMap">
	
        SELECT
        		BRD_SQ 										AS 		brdSq
              , EMPLY_SQ 									AS 		emplySq
              , BRD_TYP_CD 									AS 		brdTypCd
              , BRD_RE_REF 									AS 		brdReRep
              , BRD_RE_LEV 									AS 		brdReLev
              , BRD_RE_ORD 									AS 		brdReOrd
              , BRD_TTL 									AS 		brdTtl
              , BRD_CNTNT 									AS 		brdCntnt
              , BRD_WRTR 									AS 		brdWrtr
              , BRD_TCHR 									AS 		brdTchr
              , BRD_EDU_DT 									AS 		brdEduDt
              , DATE_FORMAT(BRD_REG_DT, '%Y-%m-%d %H:%i') 	AS 		brdRegDt
              , DATE_FORMAT(BRD_UPDT_DT, '%Y-%m-%d %H:%i') 	AS 		brdUpdtDt
              , USE_YN 										AS 		useYn
              , DEL_YN 										AS 		delYn
 		FROM 
 				TB_EEP_BRD_M 
 		WHERE
 				BRD_TYP_CD = 'NT'
 				
 				<if test='searchOption == "T" and searchOption != null'>
          			AND BRD_TTL LIKE CONCAT('%',#{searchKeyword},'%')
          		</if>
           		<if test='searchOption == "W" and searchOption != null'>
          			AND BRD_WRTR LIKE CONCAT('%',#{searchKeyword},'%')
          		</if>
          		<if test='searchOption == "C" and searchOption != null'>
          			AND BRD_CNTNT LIKE CONCAT('%',#{searchKeyword},'%')
          		</if>
          		<if test='searchOption == "TWC" and searchOption != null'>
          			AND BRD_TTL LIKE CONCAT('%',#{searchKeyword},'%')
          			OR BRD_WRTR LIKE CONCAT('%',#{searchKeyword},'%')
          			OR BRD_CNTNT LIKE CONCAT('%',#{searchKeyword},'%')
          		</if>
          		<if test='useSearchOption != null and useSearchOption != ""'>
          			AND USE_YN = #{useSearchOption}
          		</if>
          		<if test='delSearchOption != null and delSearchOption != ""'>
          			AND DEL_YN = #{delSearchOption}
          		</if>
		    
 		ORDER BY 
 				BRD_SQ DESC

    </select>

	<!-- 공지사항 등록 -->
	<insert id="noticeBoardInsertData" parameterType="hashMap">
    	INSERT INTO TB_EEP_BRD_M
        (
			 EMPLY_SQ
			,BRD_TYP_CD
			,BRD_TTL
			,BRD_CNTNT
			,BRD_WRTR
			,BRD_REG_DT
			,USE_YN 
			,DEL_YN
       	) 
        VALUES
        (
			 #{emplySq}
			,'NT'
			,#{brdTtl}
			,#{brdCntnt}
			,#{brdWrtr}
			,default
			,#{useYn}
			,default
        )
	</insert>
    
    <!-- 공지시항 상세 -->
    <select id="noticeBoardDetailData" resultType="hashMap">
        SELECT
        		BRD_SQ 										AS 		brdSq
              , EMPLY_SQ 									AS 		emplySq
              , BRD_TYP_CD 									AS 		brdTypCd
              , BRD_RE_REF 									AS 		brdReRep
              , BRD_RE_LEV 									AS 		brdReLev
              , BRD_RE_ORD 									AS 		brdReOrd
              , BRD_TTL 									AS 		brdTtl
              , BRD_CNTNT 									AS 		brdCntnt
              , BRD_WRTR 									AS 		brdWrtr
              , BRD_TCHR 									AS 		brdTchr
              , BRD_EDU_DT 									AS 		brdEduDt
              , DATE_FORMAT(BRD_REG_DT, '%Y-%m-%d %H:%i') 	AS 		brdRegDt
              , DATE_FORMAT(BRD_UPDT_DT, '%Y-%m-%d %H:%i') 	AS 		brdUpdtDt
              , USE_YN 										AS 		useYn
              , DEL_YN 										AS 		delYn
 		FROM 
 				TB_EEP_BRD_M 
 		WHERE
         		1=1 AND BRD_TYP_CD = 'NT' AND BRD_SQ = #{brdSq}
    </select>
    
    <!-- 공지시항 수정 -->
    <update id="noticeBoardUpdateData" parameterType="hashMap">
   		UPDATE 
   			TB_EEP_BRD_M
		SET
			 BRD_TTL        	= 	#{brdTtl}
			,BRD_CNTNT     		= 	#{brdCntnt}
			,BRD_UPDT_DT      	= 	NOW()
			,USE_YN 			= 	#{useYn}
			,DEL_YN 			= 	#{delYn}
   		WHERE
         	1=1 AND BRD_TYP_CD = 'NT' AND BRD_SQ = #{brdSq}
	</update>
	
	<!-- 공지시항 삭제 -->
    <update id="noticeBoardDeleteData" parameterType="hashMap">
   		UPDATE 
   			TB_EEP_BRD_M
		SET
			 DEL_YN	= 'Y'
			,USE_YN	= 'N'
   		WHERE
         	1=1 AND BRD_TYP_CD = 'NT' AND BRD_SQ = #{brdSq}
	</update>
	
    <!-- //////////////// -->
	<!-- 교육 게시판 Mapper -->
	<!-- ////////////////-->
	
	<!-- 교육 목록 및 조회 -->
	<select id="educationBoardListData" resultType="hashMap" parameterType="hashMap">
	
        SELECT
        		BRD_SQ 										AS 		brdSq
              , EMPLY_SQ 									AS 		emplySq
              , BRD_TYP_CD 									AS 		brdTypCd
              , BRD_RE_REF 									AS 		brdReRep
              , BRD_RE_LEV 									AS 		brdReLev
              , BRD_RE_ORD 									AS 		brdReOrd
              , BRD_TTL 									AS 		brdTtl
              , BRD_CNTNT 									AS 		brdCntnt
              , BRD_WRTR 									AS 		brdWrtr
              , BRD_TCHR 									AS 		brdTchr
              , BRD_EDU_DT 									AS 		brdEduDt
              , DATE_FORMAT(BRD_REG_DT, '%Y-%m-%d %H:%i') 	AS 		brdRegDt
              , DATE_FORMAT(BRD_UPDT_DT, '%Y-%m-%d %H:%i') 	AS 		brdUpdtDt
              , USE_YN 										AS 		useYn
              , DEL_YN 										AS 		delYn
 		FROM 
 				TB_EEP_BRD_M 
 		WHERE
 				BRD_TYP_CD = 'ED'
 				
 				<if test='searchOption == "T" and searchOption != null'>
          			AND BRD_TTL LIKE CONCAT('%',#{searchKeyword},'%')
          		</if>
           		<if test='searchOption == "W" and searchOption != null'>
          			AND BRD_WRTR LIKE CONCAT('%',#{searchKeyword},'%')
          		</if>
          		<if test='searchOption == "C" and searchOption != null'>
          			AND BRD_CNTNT LIKE CONCAT('%',#{searchKeyword},'%')
          		</if>
          		<if test='searchOption == "I" and searchOption != null'>
          			AND BRD_TCHR LIKE CONCAT('%',#{searchKeyword},'%')
          		</if>
          		<if test='searchOption == "TWCI" and searchOption != null'>
          			AND BRD_TTL LIKE CONCAT('%',#{searchKeyword},'%')
          			OR BRD_WRTR LIKE CONCAT('%',#{searchKeyword},'%')
          			OR BRD_CNTNT LIKE CONCAT('%',#{searchKeyword},'%')
          			OR BRD_TCHR LIKE CONCAT('%',#{searchKeyword},'%')
          		</if>
          		<if test='useSearchOption != null and useSearchOption != ""'>
          			AND USE_YN = #{useSearchOption}
          		</if>
          		<if test='delSearchOption != null and delSearchOption != ""'>
          			AND DEL_YN = #{delSearchOption}
          		</if>
		    
 		ORDER BY 
 				BRD_SQ DESC

    </select>

	<!-- 교육 등록 -->
	<insert id="educationBoardInsertData" parameterType="hashMap">
    	INSERT INTO TB_EEP_BRD_M
        (
			 EMPLY_SQ
			,BRD_TYP_CD
			,BRD_TTL
			,BRD_CNTNT
			,BRD_WRTR
			,BRD_TCHR
			,BRD_EDU_DT
			,BRD_REG_DT
			,USE_YN 
			,DEL_YN
       	) 
        VALUES
        (
			 #{emplySq}
			,'ED'
			,#{brdTtl}
			,#{brdCntnt}
			,#{brdWrtr}
			,#{brdTchr}
			,#{brdEduDt}
			,default
			,#{useYn}
			,default
        )
	</insert>
    
    <!-- 교육 상세 -->
    <select id="educationBoardDetailData" resultType="hashMap">
        SELECT
        		BRD_SQ 										AS 		brdSq
              , EMPLY_SQ 									AS 		emplySq
              , BRD_TYP_CD 									AS 		brdTypCd
              , BRD_RE_REF 									AS 		brdReRep
              , BRD_RE_LEV 									AS 		brdReLev
              , BRD_RE_ORD 									AS 		brdReOrd
              , BRD_TTL 									AS 		brdTtl
              , BRD_CNTNT 									AS 		brdCntnt
              , BRD_WRTR 									AS 		brdWrtr
              , BRD_TCHR 									AS 		brdTchr
              , BRD_EDU_DT 									AS 		brdEduDt
              , DATE_FORMAT(BRD_REG_DT, '%Y-%m-%d %H:%i') 	AS 		brdRegDt
              , DATE_FORMAT(BRD_UPDT_DT, '%Y-%m-%d %H:%i') 	AS 		brdUpdtDt
              , USE_YN 										AS 		useYn
              , DEL_YN 										AS 		delYn
 		FROM 
 				TB_EEP_BRD_M 
 		WHERE
         		1=1 AND BRD_TYP_CD = 'ED' AND BRD_SQ = #{brdSq}
    </select>
    
    <!-- 교육 수정 -->
    <update id="educationBoardUpdateData" parameterType="hashMap">
   		UPDATE 
   			TB_EEP_BRD_M
		SET
			 BRD_TTL        	= 	#{brdTtl}
			,BRD_CNTNT     		= 	#{brdCntnt}
			,BRD_TCHR 			= 	#{brdTchr}
			,BRD_EDU_DT 		= 	#{brdEduDt}
			,BRD_UPDT_DT      	= 	NOW()
			,USE_YN 			= 	#{useYn}
			,DEL_YN 			= 	#{delYn}
   		WHERE
         	1=1 AND BRD_TYP_CD = 'ED' AND BRD_SQ = #{brdSq}
	</update>
	
	<!-- 교육 삭제 -->
    <update id="educationBoardDeleteData" parameterType="hashMap">
   		UPDATE 
   			TB_EEP_BRD_M
		SET
			 DEL_YN	= 'Y'
			,USE_YN	= 'N'
   		WHERE
         	1=1 AND BRD_TYP_CD = 'ED' AND BRD_SQ = #{brdSq}
	</update>
    
    <!-- <select id="boBoardDetail" parameterType="com.eep.bo.board.vo.BoBoardVo" resultType="com.eep.bo.board.vo.BoBoardVo">
        
        SELECT BOARD_SEQ 
             , BOARD_RE_REF 
             , BOARD_RE_LEV 
             , BOARD_RE_SEQ 
             , BOARD_WRITER 
             , BOARD_SUBJECT 
             , BOARD_CONTENT 
             , BOARD_HITS
             , DEL_YN 
             , INS_USER_ID
             , CAST( DATE_FORMAT( INS_DATE, '%Y-%m-%d %H:%i:%s' ) AS CHAR(19) ) AS INS_DATE 
        FROM TB_BOARD
        WHERE BOARD_SEQ = #{boardSeq}        
              
    </select> -->
    
   <!--  <insert id="insertBoard" parameterType="com.eep.bo.board.vo.BoBoardVo">
            
        <selectKey resultType="int" keyProperty="board_re_ref" order="BEFORE">
            
            SELECT IFNULL(MAX(BOARD_RE_REF), 0) + 1 
            FROM BOARD.TB_BOARD
              
        </selectKey>
        
        INSERT 
        INTO BOARD.TB_BOARD 
        (
              BOARD_RE_REF
            , BOARD_RE_LEV
            , BOARD_RE_SEQ
            , BOARD_WRITER
            , BOARD_SUBJECT
            , BOARD_CONTENT
            , INS_USER_ID
            , INS_DATE
            , UPD_USER_ID
            , UPD_DATE
        ) 
        VALUES 
        (
              #{board_re_ref}
            , 0
            , 0
            , #{board_writer}
            , #{board_subject}
            , #{board_content}
            , 'NONMEMBER'
            , NOW() 
            , 'NONMEMBER'
            , NOW() 
        )
     
    </insert>
        
    <insert id="insertBoardFail" parameterType="com.eep.bo.board.vo.BoBoardVo">
    
        INSERT 
        INTO BOARD.TB_BOARD 
        (
                BOARD_RE_REF
              , BOARD_RE_LEV
              , BOARD_RE_SEQ
              , BOARD_WRITER
              , BOARD_SUBJECT
              , BOARD_CONTENT
              , INS_USER_ID
              , INS_DATE
              , UPD_USER_ID
              , UPD_DATE
        ) 
        VALUES 
        (
              0
            , 0
            , 0
            , #{board_writer1}
            , #{board_subject}
            , #{board_content}
            , 'NONMEMBER'
            , NOW() 
            , 'NONMEMBER'
            , NOW() 
        )
    
    </insert>
        
    <delete id="deleteBoard" parameterType="com.eep.bo.board.vo.BoBoardVo">
    
        DELETE 
        FROM BOARD.TB_BOARD 
        WHERE BOARD_SEQ = #{board_seq}
    
    </delete>
    
    <delete id="updateBoard" parameterType="com.eep.bo.board.vo.BoBoardVo">
    
        UPDATE BOARD.TB_BOARD 
           SET BOARD_SUBJECT = #{board_subject}
             , BOARD_CONTENT = #{board_content}
         WHERE BOARD_SEQ = #{board_seq}
    
    </delete>
    
    <select id="getBoardReplyInfo" parameterType="com.eep.bo.board.vo.BoBoardVo" resultType="com.eep.bo.board.vo.BoBoardVo">
    
        SELECT BOARD_SEQ
             , BOARD_RE_REF
             , BOARD_RE_LEV
             , BOARD_RE_SEQ
        FROM TB_BOARD
        WHERE BOARD_SEQ = #{board_parent_seq}
     
    </select>
    
    <delete id="updateBoardReSeq" parameterType="com.eep.bo.board.vo.BoBoardVo">
    
        UPDATE TB_BOARD
           SET BOARD_RE_SEQ = BOARD_RE_SEQ + 1
             , UPD_USER_ID = 'NONMEMBER'
             , UPD_DATE = NOW()
         WHERE BOARD_RE_REF = #{board_re_ref} 
           AND BOARD_RE_SEQ > #{board_re_seq}
     
    </delete>
 
    <insert id="insertBoardReply" parameterType="com.eep.bo.board.vo.BoBoardVo">
    
        INSERT 
        INTO BOARD.TB_BOARD 
        (
              BOARD_RE_REF
            , BOARD_RE_LEV
            , BOARD_RE_SEQ
            , BOARD_WRITER
            , BOARD_SUBJECT
            , BOARD_CONTENT
            , INS_USER_ID
            , INS_DATE
        ) 
        VALUES 
        (
              #{board_re_ref}
            , #{board_re_lev} + 1
            , #{board_re_seq} + 1
            , #{board_writer}
            , #{board_subject}
            , #{board_content}
            , 'NONMEMBER'
            , NOW() 
        )
     
    </insert> -->
	
	
</mapper>